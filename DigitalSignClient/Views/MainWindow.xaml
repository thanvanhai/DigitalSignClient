<Window x:Class="DigitalSignClient.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Digital Sign Client - Quản lý tài liệu" 
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                               CornerRadius="4"
                               Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3" Height="70">
            <Grid Margin="20,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Viewbox Width="35" Height="35">
                        <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M6,2A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6M6,4H13V9H18V20H6V4M8,12V14H16V12H8M8,16V18H13V16H8Z"/>
                        </Canvas>
                    </Viewbox>
                    <TextBlock Text="Quản lý tài liệu chữ ký số" 
                              FontSize="22" 
                              FontWeight="Bold" 
                              Foreground="White"
                              VerticalAlignment="Center"
                              Margin="15,0,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" 
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center">
                    <Viewbox Width="25" Height="25" Margin="0,0,10,0">
                        <Canvas Width="24" Height="24">
                            <Path Fill="White" Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
                        </Canvas>
                    </Viewbox>
                    <TextBlock Text="{Binding CurrentUser.FullName}" 
                              FontSize="15" 
                              Foreground="White"
                              VerticalAlignment="Center"
                              Margin="0,0,15,0"/>
                    <Button Content="Đăng xuất"
                           Foreground="White"
                           Background="Transparent"
                           BorderThickness="1"
                           BorderBrush="White"
                           Padding="12,5"
                           Click="LogoutButton_Click">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                   BorderBrush="{TemplateBinding BorderBrush}"
                                                   BorderThickness="{TemplateBinding BorderThickness}"
                                                   CornerRadius="4"
                                                   Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#1976D2"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="15"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Document List -->
            <Border Grid.Column="0" 
                   Background="White" 
                   CornerRadius="8"
                   BorderBrush="#E0E0E0"
                   BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Toolbar -->
                    <Border Grid.Row="0" 
                           Background="#F5F5F5" 
                           BorderBrush="#E0E0E0" 
                           BorderThickness="0,0,0,1"
                           Padding="15"
                           CornerRadius="8,8,0,0">
                        <StackPanel Orientation="Horizontal">
                            <Button Command="{Binding UploadCommand}"
                                   Style="{StaticResource ModernButton}"
                                   Background="#4CAF50"
                                   Foreground="White"
                                   BorderThickness="0">
                                <StackPanel Orientation="Horizontal">
                                    <Viewbox Width="18" Height="18" Margin="0,0,8,0">
                                        <Canvas Width="24" Height="24">
                                            <Path Fill="White" Data="M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"/>
                                        </Canvas>
                                    </Viewbox>
                                    <TextBlock Text="UPLOAD" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Command="{Binding RefreshCommand}"
                                   Style="{StaticResource ModernButton}"
                                   Background="#2196F3"
                                   Foreground="White"
                                   BorderThickness="0">
                                <StackPanel Orientation="Horizontal">
                                    <Viewbox Width="18" Height="18" Margin="0,0,8,0">
                                        <Canvas Width="24" Height="24">
                                            <Path Fill="White" Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/>
                                        </Canvas>
                                    </Viewbox>
                                    <TextBlock Text="LÀM MỚI" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>

                    <!-- DataGrid -->
                    <DataGrid Grid.Row="1"
                             ItemsSource="{Binding Documents}"
                             SelectedItem="{Binding SelectedDocument}"
                             AutoGenerateColumns="False"
                             CanUserAddRows="False"
                             CanUserDeleteRows="False"
                             IsReadOnly="True"
                             SelectionMode="Single"
                             GridLinesVisibility="Horizontal"
                             HeadersVisibility="Column"
                             AlternatingRowBackground="#F9F9F9"
                             Margin="10">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Tên file" 
                                              Binding="{Binding OriginalFileName}" 
                                              Width="*"/>
                            <DataGridTextColumn Header="Kích thước" 
                                              Binding="{Binding FileSize, StringFormat={}{0:N0} bytes}" 
                                              Width="120"/>
                            <DataGridTextColumn Header="Trạng thái" 
                                              Binding="{Binding Status}" 
                                              Width="120"/>
                            <DataGridCheckBoxColumn Header="Đã ký" 
                                                   Binding="{Binding IsSigned}" 
                                                   Width="80"/>
                            <DataGridTextColumn Header="Ngày upload" 
                                              Binding="{Binding UploadedAt, StringFormat={}{0:dd/MM/yyyy HH:mm}}" 
                                              Width="150"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- Detail Panel -->
            <Border Grid.Column="2" 
                   Background="White" 
                   CornerRadius="8"
                   BorderBrush="#E0E0E0"
                   BorderThickness="1"
                   Padding="20">
                <StackPanel>
                    <TextBlock Text="THAO TÁC" 
                              FontSize="16" 
                              FontWeight="Bold"
                              Margin="0,0,0,15"/>

                    <Button Command="{Binding SignCommand}"
                           Style="{StaticResource ModernButton}"
                           Background="#FF9800"
                           Foreground="White"
                           BorderThickness="0"
                           Height="50"
                           Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Viewbox Width="20" Height="20" Margin="0,0,10,0">
                                <Canvas Width="24" Height="24">
                                    <Path Fill="White" Data="M20.71,4.63L19.37,3.29C19,2.9 18.35,2.9 17.96,3.29L9,12.25L11.75,15L20.71,6.04C21.1,5.65 21.1,5 20.71,4.63M7,14A3,3 0 0,0 4,17C4,18.31 2.84,19 2,19C2.92,20.22 4.5,21 6,21A4,4 0 0,0 10,17A3,3 0 0,0 7,14Z"/>
                                </Canvas>
                            </Viewbox>
                            <TextBlock Text="KÝ TÀI LIỆU" VerticalAlignment="Center" FontWeight="Bold"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding DownloadCommand}"
                           Style="{StaticResource ModernButton}"
                           Background="#2196F3"
                           Foreground="White"
                           BorderThickness="0"
                           Height="50"
                           Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Viewbox Width="20" Height="20" Margin="0,0,10,0">
                                <Canvas Width="24" Height="24">
                                    <Path Fill="White" Data="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"/>
                                </Canvas>
                            </Viewbox>
                            <TextBlock Text="TẢI XUỐNG" VerticalAlignment="Center" FontWeight="Bold"/>
                        </StackPanel>
                    </Button>

                    <Button Command="{Binding DeleteCommand}"
                           Style="{StaticResource ModernButton}"
                           Background="#F44336"
                           Foreground="White"
                           BorderThickness="0"
                           Height="50">
                        <StackPanel Orientation="Horizontal">
                            <Viewbox Width="20" Height="20" Margin="0,0,10,0">
                                <Canvas Width="24" Height="24">
                                    <Path Fill="White" Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                                </Canvas>
                            </Viewbox>
                            <TextBlock Text="XÓA" VerticalAlignment="Center" FontWeight="Bold"/>
                        </StackPanel>
                    </Button>

                    <Rectangle Height="1" Fill="#E0E0E0" Margin="0,20"/>

                    <!-- Document Info -->
                    <StackPanel Visibility="{Binding SelectedDocument, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="THÔNG TIN" 
                                  FontSize="14" 
                                  FontWeight="Bold"
                                  Margin="0,0,0,15"/>

                        <TextBlock Text="Tên file:" 
                                  FontWeight="SemiBold"
                                  FontSize="12"
                                  Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding SelectedDocument.OriginalFileName}" 
                                  TextWrapping="Wrap"
                                  FontSize="12"
                                  Margin="0,0,0,15"/>

                        <TextBlock Text="Kích thước:" 
                                  FontWeight="SemiBold"
                                  FontSize="12"
                                  Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding SelectedDocument.FileSize, StringFormat={}{0:N0} bytes}" 
                                  FontSize="12"
                                  Margin="0,0,0,15"/>

                        <TextBlock Text="Người upload:" 
                                  FontWeight="SemiBold"
                                  FontSize="12"
                                  Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding SelectedDocument.UploadedByUsername}" 
                                  FontSize="12"
                                  Margin="0,0,0,15"/>

                        <TextBlock Text="Ngày upload:" 
                                  FontWeight="SemiBold"
                                  FontSize="12"
                                  Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding SelectedDocument.UploadedAt, StringFormat={}{0:dd/MM/yyyy HH:mm}}" 
                                  FontSize="12"
                                  Margin="0,0,0,15"/>

                        <TextBlock Text="Số chữ ký:" 
                                  FontWeight="SemiBold"
                                  FontSize="12"
                                  Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding SelectedDocument.SignatureCount}" 
                                  FontSize="12"
                                  Margin="0,0,0,15"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
               Background="#F5F5F5" 
               BorderBrush="#E0E0E0" 
               BorderThickness="0,1,0,0"
               Height="35">
            <Grid Margin="20,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Viewbox Width="18" Height="18" Margin="0,0,10,0">
                        <Canvas Width="24" Height="24">
                            <Path Fill="#666" Data="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
                        </Canvas>
                    </Viewbox>
                    <TextBlock Text="{Binding Documents.Count, StringFormat='Tổng số tài liệu: {0}'}" 
                              VerticalAlignment="Center"
                              FontSize="12"/>
                </StackPanel>

                <ProgressBar IsIndeterminate="True" 
                            Height="3"
                            Foreground="#2196F3"
                            Background="Transparent"
                            BorderThickness="0"
                            VerticalAlignment="Bottom"
                            Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </Grid>
</Window>